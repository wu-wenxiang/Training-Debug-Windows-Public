## About Symbol
- What & Why
	- [Generate symbol files for a C++ project](https://docs.microsoft.com/en-us/visualstudio/debugger/how-to-set-debug-and-release-configurations?view=vs-2017)
	- Demo: Dump call stack without & with symbol
	- Doc: [Debugging with Symbols](https://docs.microsoft.com/en-us/windows/desktop/dxtecharts/debugging-with-symbols)
		- What does the symbol path syntax mean?
		- Set environment variable: `_NT_SYMBOL_PATH`
		- `srv*[local cache]*[private symbol server]*https://msdl.microsoft.com/download/symbols`
		- `srv*c:\symbols*https://msdl.microsoft.com/download/symbols`
		- Using the Microsoft Symbol Server
			- [更多语法](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/symbol-path)
			- `.sympath c:\MyRegularSymbols;srv*c:\MyServerSymbols*https://msdl.microsoft.com/download/symbols`
			- [Agestore清理过期文件](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/using-agestore) 
	- Getting Symbols Manually
		- 手动下载单个文件到本地
		- `"c:\Program Files\Debugging Tools for Windows\symchk" c:\Windows\System32\d3dx9_30.dll /oc \.`
	- Setting Up a Symbol Server
		- 新建一个sharefolder
		- `Srv*c:\symbols*\\mainserver\symbols*https://msdl.microsoft.com/download/symbols`
		- 大家在下载Symbol时，都会在ShareFolder和本地缓存里都保留一份
	- Adding Symbols to a Symbol Server
		- `"c:\Program Files\Debugging Tools for Windows\symstore" add /f "C:\dxsym\Extras\Symbols\*.pdb"
/s \\mainserver\symbols /t "October 2006 DirectX SDK " /r`
	- Best Practices
		- Set up your own symbol server file share for your team, company, or product.
		- Set up `_NT_SYMBOL_PATH` to point to a local cache, to a private symbol server, and to the Microsoft symbol server.
		- If a debugger cannot load symbols for a component you are debugging, contact the owner of the component to request symbols—at least a stripped PDB.
		- Set up an automated build system to index symbols on your private symbol server for each build that is produced. Make sure that the builds that you distribute are the builds that are generated by this process. This ensures that symbols are always available to debug problems.
		- Set up a symbol server to allow debuggers to access the source code for a specific module directly from a Visual Source Safe or Perforce based source control system. If the source file information and symbols for a released version of a game are indexed, developers who have access to your symbol server can have full source level debugging of reported issues, without keeping build environments or old versions of source files on their development computers. To set up your symbol server to allow indexing of source file information, see source server documentation.
- Tools
	- Demo: Search symbol path in target assembly with Python
	- Demo: Search source path in symbol file with Python
	- Demo: [Dumpbin](https://msdn.microsoft.com/en-us/library/c1h23y6c.aspx?f=255&MSPPError=-2147217396)
		- Developer Command Prompt for VS2017
		- `dumpbin /symbols CrashMe.exe`
		- `dumpbin /PDBPATH:VERBOSE CrashMe.exe`
		- `dumpbin /headers CrashMe.exe`
	- Demo: [pdbcopy](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/using-pdbcopy)
		- `copy "C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\pdbcopy.exe" .`
		- `pdbcopy CrashMe.pdb public.pdb -p`
		- `dir`
		- `dv` & "source lines" differences
		- Private PDB
			- Public symbols (typically all functions, static and global variables)
			- A list of object files that are responsible for sections of code in the executable
			- Frame pointer optimization information (FPO)
			- Name and type information for local variables and data structures
			- Source file and line number information
		- Stripped PDB
			- Public symbols (typically only non-static functions and global variables)
			- A list of object files that are responsible for sections of code in the executable
			- Frame pointer optimization information (FPO)
	- Demo: [chkmatch](http://www.debuginfo.com/tools/chkmatch.html)：
		- `chkmatch -c ExeFile DebugInfoFile`
		- `chkmatch -m ExeFile DebugInfoFile`
	- Demo: [Force Load Symbol](http://ntcoder.com/bab/2012/03/06/how-to-force-symbol-loading-in-windbg/): 
		- `.symopt+ 0x40`
		- `.reload /f /i test.exe`
		- [`.reload /f /i MyDll.dll=77777777`](https://stackoverflow.com/questions/10979418/forcing-windbg-to-load-symbols-of-an-unloaded-module)
	- Demo: [Symchk](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/using-symchk)
	
			"c:\Program Files\Debugging Tools for Windows\symchk" testing.dll /s
			SYMCHK: FAILED files = 0
			SYMCHK: PASSED + IGNORED files = 1  
- Symbol Hacker
	- Demo: [Export functions](https://github.com/wu-wenxiang/Training-Debug-Windows-Public/tree/master/src/TestDLL/TestDLL)
		- `dumpbin /exports xxx.dll`
		- [Static call](https://github.com/wu-wenxiang/Training-Debug-Windows-Public/tree/master/src/TestDLL/Demo-01-StaticLoad)
		- [Dynamic call](https://github.com/wu-wenxiang/Training-Debug-Windows-Public/tree/master/src/TestDLL/Demo-02-DynamicLoad): [GetProcAddress](https://docs.microsoft.com/en-us/windows/desktop/api/libloaderapi/nf-libloaderapi-getprocaddress)
		- Python call: [mydebgger](https://github.com/wu-wenxiang/Training-Debug-Windows-Public/blob/master/src/grayHat-src/my_test.py)

				from ctypes import *
				msvcrt = cdll.msvcrt
				msg = b"Hello\n"
				msvcrt.printf(b"aStr: %s", msg)
	- [Demo: Call internal functions](https://github.com/wu-wenxiang/Training-Debug-Windows-Public/tree/master/src/TestDLL/Demo-03-InternalFunction) by [SymFromName](https://docs.microsoft.com/en-us/windows/desktop/api/dbghelp/nf-dbghelp-symfromname)
		- Real case: linkinfo
		- Real case: scan
- Others
	- What the order when windbg load symbols
		- Order:
			- The location that is specified inside the DLL or the executable file.
			- PDBs that may be present in the same folder as the DLL or executable file.
			- Any local symbol cache folders.
			- Any local network file share symbol servers.
			- Any Internet symbol servers, such as the Microsoft symbol server.
		- Demo: Procmon
	- What if without symbol
		- [OLE-COM Object Viewer](https://docs.microsoft.com/en-us/windows/desktop/com/ole-com-object-viewer), [Usage](https://docs.microsoft.com/en-us/previous-versions/d0kh9f4c(v=vs.140))
		- [Metadata and Self-Describing Components](https://docs.microsoft.com/en-us/dotnet/standard/metadata-and-self-describing-components)
